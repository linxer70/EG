tinymce.PluginManager.requireLangPack('formula', 'en,ar,es,fr_FR,ko_KR')
tinymce.PluginManager.add('formula', (editor, url) => {
  const showFormulaDialog = () => {
	
    editor.windowManager.open({
      title: '수식 만들기',
      width: '100%',
      height: '600px',
      body: {
        type: 'panel',
        items: [
          {
            type: 'htmlpanel',
            html: buildIFrame(editor, url)
          }
        ]
      },
      buttons: [
        {
          text: '취소',
          type: 'cancel'
        },
        {
          text: '수식 입력',
          type: 'submit',
          buttonType: 'primary',
        }
      ],
	  
      onSubmit: (dialogApi) => {
        let me = this
        if (
          window.frames['tinymceFormula'] &&
              window.frames['tinymceFormula'].getData
        ) {
          window.frames['tinymceFormula'].getData(function(
            src,
            mlang,
            equation
          ) {
            if (src) {
              editor.insertContent(
                '<img class="fm-editor-equation" src="' +
                      src +
                      '" data-mlang="' +
                      mlang +
                      '" data-equation="' +
                      encodeURIComponent(equation) +
                      '"/>'
              )
            }
            dialogApi.close()
          })
        }
        else {
          dialogApi.close()
        }
      }
    });
  };
  //const jsonString = JSON.stringify(editor);
  //console.log(jsonString+""+url);
  editor.addCommand('mceFormula', showFormulaDialog);	
  /*
  var viewmceEditor = tinymce.get('viewmce');
  if (viewmceEditor) {
	console.log('Editor with ID "viewmce" found')
  } else {
    console.log('Editor with ID "viewmce" not found');
	}
 */ 
	window.manipulateElementById = manipulateElementById; 
  
  const buildIFrame = () => {
    let currentNode = editor.selection.getNode()
    let lang = 'en'//editor.getParam('language') || 'en'
    let mlangParam = ''
    let equationParam = ''
    if (
      currentNode.nodeName.toLowerCase() == 'img' &&
      currentNode.className.indexOf('fm-editor-equation') > -1
    ) {
      if (currentNode.getAttribute('data-mlang')) { mlangParam = '&mlang=' + currentNode.getAttribute('data-mlang') }
      if (currentNode.getAttribute('data-equation')) {
        equationParam =
          '&equation=' + currentNode.getAttribute('data-equation')
      }
    }
    let html =
      '<iframe style="width: 100%; height: 600px" name="tinymceFormula" id="tinymceFormula" src="' +
      url +
      '/index.html' +
      '?lang=' +
      lang +
      mlangParam +
      equationParam +
      '" scrolling="yes" frameborder="0"></iframe>'
    return html
  }

  const options = editor.getParam('formula') || {}
  const path = options.path || url

  //editor.ui.registry.addIcon('formula', '<?xml version="1.0" encoding="utf-8"?><svg width="24" height="24" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 121.83 122.88" style="enable-background:new 0 0 121.83 122.88" xml:space="preserve"><g><path d="M27.61,34.37l-4.07,4.6l0.4,1.74h10.48c-2.14,12.38-3.74,23.54-6.81,40.74c-3.67,21.94-5.78,27.33-7.03,29.3 c-1.1,1.95-2.68,2.96-4.82,2.96c-2.35,0-6.6-1.86-8.88-3.97c-0.82-0.56-1.79-0.42-2.82,0.26C2,111.74,0,114.42,0,116.82 c-0.12,3.24,4.21,6.06,8.34,6.06c3.64,0,9-2.28,14.64-7.64c7.71-7.31,13.48-17.34,18.3-39.02c3.1-13.84,4.56-22.84,6.74-35.5 l13.02-1.18l2.82-5.17H49.2C52.99,10.53,55.95,7,59.59,7c2.42,0,5.24,1.86,8.48,5.52c0.96,1.32,2.4,1.18,3.5,0.28 c1.85-1.1,4.13-3.92,4.28-6.48C75.96,3.5,72.6,0,66.82,0C61.58,0,53.55,3.5,46.8,10.38c-5.92,6.27-9.02,14.1-11.16,23.99H27.61 L27.61,34.37z M69.27,50.33c4.04-5.38,6.46-7.17,7.71-7.17c1.29,0,2.32,1.27,4.53,8.41l3.78,12.19 c-7.31,11.18-12.66,17.41-15.91,17.41c-1.08,0-2.17-0.34-2.94-1.1c-0.76-0.76-1.6-1.39-2.42-1.39c-2.68,0-6,3.25-6.06,7.28 c-0.06,4.11,2.82,7.05,6.6,7.05c6.49,0,11.98-6.37,22.58-23.26l3.1,10.45c2.66,8.98,5.78,12.81,9.68,12.81 c4.82,0,11.3-4.11,18.37-15.22l-2.96-3.38c-4.25,5.12-7.07,7.52-8.74,7.52c-1.86,0-3.49-2.84-5.64-9.82l-4.53-14.73 c2.68-3.95,5.32-7.27,7.64-9.92c2.76-3.15,4.89-4.49,6.34-4.49c1.22,0,2.28,0.52,2.94,1.25c0.87,0.96,1.39,1.41,2.42,1.41 c2.33,0,5.93-2.96,6.06-6.88c0.12-3.64-2.14-6.74-6.06-6.74c-5.92,0-11.14,5.1-21.19,20.04l-2.07-6.41 c-2.9-9-4.82-13.63-8.86-13.63c-4.7,0-11.16,5.78-17.48,14.94L69.27,50.33L69.27,50.33z"/></g></svg>')
  editor.ui.registry.addIcon('formula', `
    <svg xmlns="http://www.w3.org/2000/svg" width="120" height="24" viewBox="0 0 24 24">
      <text x="0" y="18" font-size="16" font-family="Arial" fill="white">수식</text>
    </svg>
  `);
  
  editor.ui.registry.addButton('formula', {
    icon: 'formula',
    tooltip: '수식 입력',
    onAction: () => {
      showFormulaDialog(this, editor, path)
    },
    onPostRender: function() {
      let _this = this // reference to the button itself
      editor.on('NodeChange', function(e) {
        _this.active(
          e.element.className.indexOf('fm-editor-equation') > -1 &&
            e.element.nodeName.toLowerCase() == 'img'
        )
      })
    }
  })
  
  function manipulateElementById(elementId,cmd,cmd1) {
	console.log('Element with 0ID ' + elementId + ' found.');
	console.log('Element with 0ID ' + cmd + ' found.');
	var element = document.getElementById(elementId);
	if (element) {
		if (arguments.length === 0) {
			
		} else if(arguments.length === 1) {
//			console.log('Element with 1ID ' + cmd + ' found.');
			tinymce.get(elementId).execCommand('mceFormula');
		} else if(arguments.length === 2) {
//			console.log('Element with ID ' + cmd + ' found.');
				tinymce.get(elementId).execCommand(cmd);
		} else if(arguments.length === 3) {
			if(cmd==='fontname'){
				menuClicked(elementId,cmd);
			}else if(cmd==='table'){
				menuTableClicked(elementId,cmd)
			}else{
				tinymce.get(elementId).execCommand('FontName', true, '궁서체');
			}
			/*
			if(cmd==='fontname'){
//				console.log('Element with ID ' + cmd + ' found.');
				tinymce.get(elementId).execCommand('FontName', true, '궁서체');
			}else{
				tinymce.get(elementId).execCommand('ForeColor', true, cmd1);
			}
			*/
		}
	}
/*		  
	var element = document.getElementById(elementId);
    if (element) {
		tinymce.get(elementId).execCommand('mceFormula');
		console.log('Element with ID ' + elementId + ' not found.');
    } else {
      console.log('Element with ID ' + elementId + ' not found.');
    }
	
	<div role="menu" class="tox-menu tox-collection tox-collection--list tox-selected-menu" 
	style="position: absolute; left: 368px; top: -701.766px; max-height: 699px; overflow: hidden auto; min-width: 44px;" data-alloy-placement="southeast"><div class="tox-collection__group">
	<div title="굵게" id="menu-item_2059563269451740450858194" role="menuitem" aria-haspopup="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false" aria-selected="false"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><path d="M7.8 19c-.3 0-.5 0-.6-.2l-.2-.5V5.7c0-.2 0-.4.2-.5l.6-.2h5c1.5 0 2.7.3 3.5 1 .7.6 1.1 1.4 1.1 2.5a3 3 0 0 1-.6 1.9c-.4.6-1 1-1.6 1.2.4.1.9.3 1.3.6s.8.7 1 1.2c.4.4.5 1 .5 1.6 0 1.3-.4 2.3-1.3 3-.8.7-2.1 1-3.8 1H7.8Zm5-8.3c.6 0 1.2-.1 1.6-.5.4-.3.6-.7.6-1.3 0-1.1-.8-1.7-2.3-1.7H9.3v3.5h3.4Zm.5 6c.7 0 1.3-.1 1.7-.4.4-.4.6-.9.6-1.5s-.2-1-.7-1.4c-.4-.3-1-.4-2-.4H9.4v3.8h4Z" fill-rule="evenodd"></path></svg></div><div class="tox-collection__item-label">굵게</div><div class="tox-collection__item-accessory">Ctrl+B</div></div><div title="기울임꼴" id="menu-item_9066926729491740450858194" role="menuitem" aria-haspopup="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false" aria-selected="false"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><path d="m16.7 4.7-.1.9h-.3c-.6 0-1 0-1.4.3-.3.3-.4.6-.5 1.1l-2.1 9.8v.6c0 .5.4.8 1.4.8h.2l-.2.8H8l.2-.8h.2c1.1 0 1.8-.5 2-1.5l2-9.8.1-.5c0-.6-.4-.8-1.4-.8h-.3l.2-.9h5.8Z" fill-rule="evenodd"></path></svg></div><div class="tox-collection__item-label">기울임꼴</div><div class="tox-collection__item-accessory">Ctrl+I</div></div><div title="밑줄" id="menu-item_7986284459531740450858195" role="menuitem" aria-haspopup="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false" aria-selected="false"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><path d="M16 5c.6 0 1 .4 1 1v5.5a4 4 0 0 1-.4 1.8l-1 1.4a5.3 5.3 0 0 1-5.5 1 5 5 0 0 1-1.6-1c-.5-.4-.8-.9-1.1-1.4a4 4 0 0 1-.4-1.8V6c0-.6.4-1 1-1s1 .4 1 1v5.5c0 .3 0 .6.2 1l.6.7a3.3 3.3 0 0 0 2.2.8 3.4 3.4 0 0 0 2.2-.8c.3-.2.4-.5.6-.8l.2-.9V6c0-.6.4-1 1-1ZM8 17h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 0 1 0-2Z" fill-rule="evenodd"></path></svg></div><div class="tox-collection__item-label">밑줄</div><div class="tox-collection__item-accessory">Ctrl+U</div></div><div title="취소선" id="menu-item_8368090599571740450858195" role="menuitem" aria-haspopup="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item tox-collection__item--active" aria-disabled="false" aria-selected="true"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><g fill-rule="evenodd"><path d="M15.6 8.5c-.5-.7-1-1.1-1.3-1.3-.6-.4-1.3-.6-2-.6-2.7 0-2.8 1.7-2.8 2.1 0 1.6 1.8 2 3.2 2.3 4.4.9 4.6 2.8 4.6 3.9 0 1.4-.7 4.1-5 4.1A6.2 6.2 0 0 1 7 16.4l1.5-1.1c.4.6 1.6 2 3.7 2 1.6 0 2.5-.4 3-1.2.4-.8.3-2-.8-2.6-.7-.4-1.6-.7-2.9-1-1-.2-3.9-.8-3.9-3.6C7.6 6 10.3 5 12.4 5c2.9 0 4.2 1.6 4.7 2.4l-1.5 1.1Z"></path><path d="M5 11h14a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z" fill-rule="nonzero"></path></g></svg></div><div class="tox-collection__item-label">취소선</div></div><div title="위 첨자" id="menu-item_4494944999601740450858195" role="menuitem" aria-haspopup="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><path d="M15 9.4 10.4 14l4.6 4.6-1.4 1.4L9 15.4 4.4 20 3 18.6 7.6 14 3 9.4 4.4 8 9 12.6 13.6 8 15 9.4Zm5.9 1.6h-5v-1l1-.8 1.7-1.6c.3-.5.5-.9.5-1.3 0-.3 0-.5-.2-.7-.2-.2-.5-.3-.9-.3l-.8.2-.7.4-.4-1.2c.2-.2.5-.4 1-.5.3-.2.8-.2 1.2-.2.8 0 1.4.2 1.8.6.4.4.6 1 .6 1.6 0 .5-.2 1-.5 1.5l-1.3 1.4-.6.5h2.6V11Z" fill-rule="nonzero"></path></svg></div><div class="tox-collection__item-label">위 첨자</div></div><div title="아래 첨자" id="menu-item_8111904769631740450858195" role="menuitem" aria-haspopup="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><path d="m10.4 10 4.6 4.6-1.4 1.4L9 11.4 4.4 16 3 14.6 7.6 10 3 5.4 4.4 4 9 8.6 13.6 4 15 5.4 10.4 10ZM21 19h-5v-1l1-.8 1.7-1.6c.3-.4.5-.8.5-1.2 0-.3 0-.6-.2-.7-.2-.2-.5-.3-.9-.3a2 2 0 0 0-.8.2l-.7.3-.4-1.1 1-.6 1.2-.2c.8 0 1.4.3 1.8.7.4.4.6.9.6 1.5s-.2 1.1-.5 1.6a8 8 0 0 1-1.3 1.3l-.6.6h2.6V19Z" fill-rule="nonzero"></path></svg></div><div class="tox-collection__item-label">아래 첨자</div></div><div title="Code" id="menu-item_4181092929661740450858195" role="menuitem" aria-haspopup="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><g fill-rule="nonzero"><path d="M9.8 15.7c.3.3.3.8 0 1-.3.4-.9.4-1.2 0l-4.4-4.1a.8.8 0 0 1 0-1.2l4.4-4.2c.3-.3.9-.3 1.2 0 .3.3.3.8 0 1.1L6 12l3.8 3.7ZM14.2 15.7c-.3.3-.3.8 0 1 .4.4.9.4 1.2 0l4.4-4.1c.3-.3.3-.9 0-1.2l-4.4-4.2a.8.8 0 0 0-1.2 0c-.3.3-.3.8 0 1.1L18 12l-3.8 3.7Z"></path></g></svg></div><div class="tox-collection__item-label">Code</div></div></div><div class="tox-collection__group"><div title="서식" id="menu-item_7262378909681740450858202" role="menuitem" aria-haspopup="true" aria-expanded="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"></div><div class="tox-collection__item-label">서식</div><div class="tox-collection__item-caret"><svg width="10" height="10" focusable="false"><path d="M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3Z" fill-rule="nonzero"></path></svg></div></div><div title="블록" id="menu-item_5751651469701740450858204" role="menuitem" aria-haspopup="true" aria-expanded="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"></div><div class="tox-collection__item-label">블록</div><div class="tox-collection__item-caret"><svg width="10" height="10" focusable="false"><path d="M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3Z" fill-rule="nonzero"></path></svg></div></div><div title="글꼴" id="menu-item_2314678219721740450858204" role="menuitem" aria-haspopup="true" aria-expanded="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"></div><div class="tox-collection__item-label">글꼴</div><div class="tox-collection__item-caret"><svg width="10" height="10" focusable="false"><path d="M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3Z" fill-rule="nonzero"></path></svg></div></div><div title="글꼴 크기" id="menu-item_9031632929741740450858205" role="menuitem" aria-haspopup="true" aria-expanded="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"></div><div class="tox-collection__item-label">글꼴 크기</div><div class="tox-collection__item-caret"><svg width="10" height="10" focusable="false"><path d="M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3Z" fill-rule="nonzero"></path></svg></div></div><div title="정렬" id="menu-item_967684119761740450858205" role="menuitem" aria-haspopup="true" aria-expanded="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"></div><div class="tox-collection__item-label">정렬</div><div class="tox-collection__item-caret"><svg width="10" height="10" focusable="false"><path d="M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3Z" fill-rule="nonzero"></path></svg></div></div><div title="행 높이" id="menu-item_8012423479781740450858206" role="menuitem" aria-haspopup="true" aria-expanded="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"></div><div class="tox-collection__item-label">행 높이</div><div class="tox-collection__item-caret"><svg width="10" height="10" focusable="false"><path d="M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3Z" fill-rule="nonzero"></path></svg></div></div></div><div class="tox-collection__group"><div title="글자 색" id="menu-item_3942879679801740450858206" role="menuitem" aria-haspopup="true" aria-expanded="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><g fill-rule="evenodd"><path class="tox-icon-text-color__color" d="M3 18h18v3H3z" fill="#000000"></path><path d="M8.7 16h-.8a.5.5 0 0 1-.5-.6l2.7-9c.1-.3.3-.4.5-.4h2.8c.2 0 .4.1.5.4l2.7 9a.5.5 0 0 1-.5.6h-.8a.5.5 0 0 1-.4-.4l-.7-2.2c0-.3-.3-.4-.5-.4h-3.4c-.2 0-.4.1-.5.4l-.7 2.2c0 .3-.2.4-.4.4Zm2.6-7.6-.6 2a.5.5 0 0 0 .5.6h1.6a.5.5 0 0 0 .5-.6l-.6-2c0-.3-.3-.4-.5-.4h-.4c-.2 0-.4.1-.5.4Z"></path></g></svg></div><div class="tox-collection__item-label">글자 색</div><div class="tox-collection__item-caret"><svg width="10" height="10" focusable="false"><path d="M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3Z" fill-rule="nonzero"></path></svg></div></div><div title="배경 색" id="menu-item_27790899821740450858206" role="menuitem" aria-haspopup="true" aria-expanded="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><g fill-rule="evenodd"><path class="tox-icon-highlight-bg-color__color" d="M3 18h18v3H3z" fill="#000000"></path><path fill-rule="nonzero" d="M7.7 16.7H3l3.3-3.3-.7-.8L10.2 8l4 4.1-4 4.2c-.2.2-.6.2-.8 0l-.6-.7-1.1 1.1zm5-7.5L11 7.4l3-2.9a2 2 0 0 1 2.6 0L18 6c.7.7.7 2 0 2.7l-2.9 2.9-1.8-1.8-.5-.6"></path></g></svg></div><div class="tox-collection__item-label">배경 색</div><div class="tox-collection__item-caret"><svg width="10" height="10" focusable="false"><path d="M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3Z" fill-rule="nonzero"></path></svg></div></div></div><div class="tox-collection__group"><div title="서식 지우기" id="menu-item_1846778009851740450858207" role="menuitem" aria-haspopup="false" tabindex="-1" class="tox-menu-nav__js tox-collection__item" aria-disabled="false"><div class="tox-collection__item-icon"><svg width="24" height="24" focusable="false"><path d="M13.2 6a1 1 0 0 1 0 .2l-2.6 10a1 1 0 0 1-1 .8h-.2a.8.8 0 0 1-.8-1l2.6-10H8a1 1 0 1 1 0-2h9a1 1 0 0 1 0 2h-3.8ZM5 18h7a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Zm13 1.5L16.5 18 15 19.5a.7.7 0 0 1-1-1l1.5-1.5-1.5-1.5a.7.7 0 0 1 1-1l1.5 1.5 1.5-1.5a.7.7 0 0 1 1 1L17.5 17l1.5 1.5a.7.7 0 0 1-1 1Z" fill-rule="evenodd"></path></svg></div><div class="tox-collection__item-label">서식 지우기</div></div></div></div>
		
*/	

  }  
 
  function menuTableClicked(elementId,cmd) {
  const editor = tinymce.get(elementId);
  const menuButton = Array.from(tinymce.get(elementId).getContainer().querySelectorAll('button.tox-mbtn--select'))
      .find(btn => btn.querySelector('.tox-mbtn__select-label')?.textContent.trim() === "표");
  if (menuButton) menuButton.click();
  }
  
  function menuClicked(elementId,cmd) {

	//const editor = tinymce.get(elementId);
	//editor.focus();
	
	// XPath로 "파일" 텍스트가 포함된 버튼 찾기
	//const xpath = '//button[contains(@class, "tox-mbtn")]//span[contains(@class, "tox-mbtn__select-label") and text()="서식"]/ancestor::button';
	//const menuButton = document.evaluate(xpath, tinymce.get(elementId).getContainer(), null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
	//const menuButton =tinymce.get(elementId).dom.select('button[data-menu-type="서식"]')[0].click();
	const editor = tinymce.get(elementId);
	const menuButton = Array.from(tinymce.get(elementId).getContainer().querySelectorAll('button.tox-mbtn--select'))
	    .find(btn => btn.querySelector('.tox-mbtn__select-label')?.textContent.trim() === "서식");
	if (menuButton) menuButton.click();
	/*
	if (menuButton) {
	  menuButton.dispatchEvent(new MouseEvent('click', {
	    bubbles: true,
	    cancelable: true,
	    view: window
	  }));
	  //editor.fire('ResizeWindow');

	  /*  
	  const xpath = '//button[contains(@class, "tox-mbtn")]//span[contains(@class, "tox-mbtn__select-label") and text()="서식"]/ancestor::button';
	  const menuButton = document.evaluate(xpath, tinymce.get(elementId).getContainer(), null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
		menuButton?.click();

	  // 3. 위치 재계산 + 수동 조정
	  setTimeout(() => {
	    // 내부 함수로 재계산
	    if (window.tinymce.get(elementId).ui.Menu) {
	      window.tinymce.get(elementId).ui.Menu.repositionAll();
	    }

	    // 추가 수동 조정 (필요시)
	    const menu = tinymce.get(elementId).dom.select('.tox-menu')[0];
	    if (menu) {
	      menu.style.top = '100px';
	    }
	  }, 150);
	  */	  	  
	
	}
        
  /* Return the metadata for the help plugin */
  return {
    getMetadata: () => ({
      name: 'Formula',
      url: 'https://github.com/umar221b/tinymce-formula'
    })
  }
})
